name: GitHub Backup

on:
  push:
    branches:
      - github-backup

jobs:
  backup:
    runs-on: ubuntu-latest
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    steps:
    - name: Run
      # docker run -it --rm -e GET_TAGS=1 -e GET_BRANCH=1 -e BASE_DIR=/github_backup_20230406 -e GITHUB_OWNER=hongfs -e BAIDUPAN_TOKEN=${{ secrets.BACKUP_BAIDUPAN_TOKEN }} -e GITHUB_TOKEN=${{ secrets.BACKUP_GITHUB_TOKEN }} ghcr.io/hongfs/env:github-backup-to-baidupan
      run: |
        docker run -e HAS_ALL=1 -e GET_TAGS=1 -e GET_BRANCH=1 -e BASE_DIR=github/ -e GITHUB_OWNER=hongfs -e BAIDUPAN_TOKEN=${{ secrets.BACKUP_BAIDUPAN_TOKEN }} -e GITHUB_TOKEN=${{ secrets.BACKUP_GITHUB_TOKEN }} -e OSS_BUCKET=hongfs-backup-v3 -e OSS_ENDPOINT=oss-cn-shenzhen.aliyuncs.com -e OSS_ACCESS_KEY_ID=LTAI5tJUjQbWbuBF724KyM3a -e OSS_ACCESS_KEY_SECRET=${{ secrets.OSS_ACCESS_KEY_SECRET }} registry.cn-shenzhen.aliyuncs.com/hongfs/backup-to-oss:main
